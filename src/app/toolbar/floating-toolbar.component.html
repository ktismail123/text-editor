<ng-container *ngIf="{
  visible: isVisible | async,
  pos: position | async,
  state: activeStates | async
} as data">

<div class="floating-toolbar" 
     [class.visible]="data.visible"
     [style.top.px]="data.pos?.top"
     [style.left.px]="data.pos?.left"
     (mousedown)="handleMousedown($event)">
  
  <!-- Section 1: History -->
  <div class="group history-group">
    <button type="button" class="btn-dark" (mousedown)="$event.preventDefault()" (click)="exec('undo')" title="Undo">
      <svg viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg>
    </button>
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" (click)="exec('redo')" title="Redo">
      <svg viewBox="0 0 24 24"><path d="M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></svg>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Section 2: Basic Formatting -->
  <div class="group">
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" [class.active]="data.state?.['bold']" (click)="exec('bold')" title="Bold">
      <span style="font-weight: bold; font-family: serif;">B</span>
    </button>
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" [class.active]="data.state?.['underline']" (click)="exec('underline')" title="Underline">
      <span style="text-decoration: underline; font-family: serif;">U</span>
    </button>
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" [class.active]="data.state?.['italic']" (click)="exec('italic')" title="Italic">
      <span style="font-style: italic; font-family: serif;">I</span>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Section 3: Colors -->
  <div class="group">
    <div class="color-wrapper" title="Text Color">
       <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()">
         <span style="text-decoration: underline; text-decoration-color: currentColor; font-weight: bold;">A</span>
       </button>
       <input type="color" (input)="exec('foreColor', $any($event.target).value)" />
    </div>
    
    <div class="color-wrapper" title="Background Color">
       <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()">
         <svg viewBox="0 0 24 24"><path d="M16.56 8.94L7.62 0 6.21 1.41l2.38 2.38-5.15 5.15c-.59.59-.59 1.54 0 2.12l5.5 5.5c.29.29.68.44 1.06.44s.77-.15 1.06-.44l5.5-5.5c.59-.58.59-1.53 0-2.12zM5.21 10L10 5.21 14.79 10H5.21zM19 11.5s-2 2.17-2 3.5c0 1.1.9 2 2 2s2-.9 2-2-2-3.5-2-3.5zM2 20h20v4H2v-4z"/></svg>
       </button>
       <input type="color" (input)="exec('hiliteColor', $any($event.target).value)" />
    </div>
  </div>

  <div class="divider"></div>

  <!-- Section 4: Alignment -->
  <div class="group">
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" [class.active]="data.state?.['justifyLeft']" (click)="exec('justifyLeft')" title="Left">
      <svg viewBox="0 0 24 24"><path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/></svg>
    </button>
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" [class.active]="data.state?.['justifyCenter']" (click)="exec('justifyCenter')" title="Center">
      <svg viewBox="0 0 24 24"><path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/></svg>
    </button>
     <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" [class.active]="data.state?.['justifyRight']" (click)="exec('justifyRight')" title="Right">
      <svg viewBox="0 0 24 24"><path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/></svg>
    </button>
  </div>

  <div class="divider"></div>
  
  <!-- Section 5: Font Size -->
  <div class="group font-size-group">
     <button type="button" class="btn-round" (mousedown)="$event.preventDefault()" (click)="changeFontSize(-0.5)">
       <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg>
     </button>
     
     <div class="size-input-wrapper">
         <input type="number" 
                [value]="data.state?.['fontSize'] || 12" 
                (change)="setManualFontSize($any($event.target).value)"
                step="0.5"
                min="1">
     </div>

     <button type="button" class="btn-round" (mousedown)="$event.preventDefault()" (click)="changeFontSize(0.5)">
       <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
     </button>
  </div>
  
  <div class="divider"></div>

  <!-- Section 6: Extras -->
  <div class="group">
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" (click)="exec('copy')" title="Copy">
        <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
    </button>
    <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" (click)="execWithPrompt('createLink', 'Enter URL:')" title="Link">
        <svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
    </button>
     <button type="button" class="btn-round-large" (mousedown)="$event.preventDefault()" (click)="exec('removeFormat')" title="Clear">
       <svg viewBox="0 0 24 24"><path d="M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3v10zM14 5h-3l-1-1H6L5 5H2v2h12z"/></svg>
    </button>
  </div>

   <div class="divider"></div>

  <!-- Close -->
  <button type="button" class="btn-icon" (mousedown)="$event.preventDefault()" (click)="close()" title="Close">
    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
  </button>

</div>
</ng-container>
